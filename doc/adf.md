# **ADF検定**
※参考: [Pythonで時系列解析・超入門 (その1)](https://www.salesanalytics.co.jp/datascience/datascience085/)
※../src/adf.ipynbで使用

## **時系列の主な4つの成分**
時系列データの原系列は主に以下の4つの変動成分で構成される。

- T：趨勢変動成分
    - データの長期的な増加または減少を表現する成分
- C：循環変動成分
    - 周期的なパターンを表現する成分
    - 季節変動成分と似たような概念だが、季節変動成分が一定の周期を持っているのに対し、こちらの周期は一定である必要はない
    - 季節変動成分と異なり、2年以上と長い
- S：季節変動成分
    - 一定の周期パターンを持った成分。例えば、データの粒度が1日単位であれば、週周期や年周期など。循環変動成分と比べ、周期が短く長くても1年程度。
- I：不規則変動成分

- 以下のようにまとめることもある
    - TC（趨勢循環変動成分）-> トレンド成分
    - S（季節変動成分）-> 季節成分
    - I（不規則変動成分）-> 残差成分

## **3つの特徴把握方法**
1. 時系列データの変動成分の分解
2. 時系列データが定常化どうかの確認
3. コレログラム ( ACF & PACF ) の確認

## **加法モデルと情報モデル**
- 加法モデル
    - 原系列 ＝ T+C+S+I

- 乗法モデル
    - 原系列 ＝ T×C×S×I

## **時系列データの変動成分の分解**
時系列データを手にしたら先ずすべきは、以下の3つの変動成分の分解。どのような時系列データなのか、ざっくり掴める。
1. 移動平均法を利用した分解（加法モデルを仮定）
2. 移動平均法を利用した分解（乗法モデルを仮定）
    - statsmodelsライブラリーのseasonal_decompose()関数を使う
        1. 設定した季節性の周期の移動平均を計算しトレンド成分とする
        2. 原系列からトレンド成分を除去し季節成分（平均値を0に調整）を求める
        3. 原系列からトレンド成分と季節成分を除去し残差を求める
3. STL分解（LOESS平滑化を利用した分解）
    - statsmodelsライブラリーのSTL()関数を使う。
    - これが無難。外れ値に強い

## **時系列データが定常かどうかの確認**
定常な時系列データは、時間によって平均や分散、共分散が変化しない時系列データのこと。トレンド成分や季節成分がある時系列データは非定常と言える可能性が高い。例えば、時間とともにデータの値が大きくなる場合、それは時間に依存しているため、非定常な時系列データといえる。古典的な時系列解析手法では、どうすれば非定常な時系列データが定常状態になるかを検討するステップを挟む。そうすることで、トレンド成分を考慮したモデルを作るべきなのか、季節成分を考慮したモデルを作るべきなのかが分かる。

### ADF検定 ( 拡張ディッキーフラー検定, argmented Dicky-Fuller test )

- 帰無仮説H0：時系列は非定常である（単位根をもつ）
- 対立仮説H1：時系列は定常である（単位根をもたない）

単位根過程 ( 単位根を持つ時系列データ )は、原系列は否定上であるが、差分を取ると定常になるデータ。単位根の有無を検定する方法の一つがDF検定。それを拡張したのが、ADF検定。

### 4つのADF検定

1. 原系列に対するADF検定
    - 通常はここで定常であるという結果はでない
2. 原系列を対数変換し得た対数系列に対するADF検定
    - 時間とともに分散が増加するといった現象を抑えることができる
3. 対数系列の階差系列（次数1）に対するADF検定
    - 原系列を対数変化し得た対数系列に対し、1期前との差分を計算し新たな時系列データを作り、その新たな時系列データに対するADF検定
    - 線形トレンドは、階差系列（次数1）を作ることで除去可能
4. 対数系列の階差系列（次数1）の季節階差系列（次数1）に対するADF検定
    - 原系列の対数系列の階差系列（次数1）に対し、12期前（1年前）との差分を計算し新たな時系列データを作り、その新たな時系列データに対するADF検定

- 結果の見方
    - p値（p-value）が0.01より小さいとき1%有意、0.05より小さいとき5%有意、0.1より小さいとき10%有意と呼ばれる。
    - 有意の場合、帰無仮説（時系列は非定常である）を棄却し対立仮説（時系列は定常である）を採択する
